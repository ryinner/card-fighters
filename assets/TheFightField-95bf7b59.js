var X=Object.defineProperty;var K=(a,e,t)=>e in a?X(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var y=(a,e,t)=>(K(a,typeof e!="symbol"?e+"":e,t),t);import{M as Y,D as J,m as Q,a as h,k as g,q as Z,d as b,c as p,g as v,w as m,s as ee,o as d,i as F,t as P,b as u,F as T,l as I,e as w,_ as E,u as C,v as te,T as ae,j as se,x as re,y as oe,z as H,A as L,B as ie}from"./index-2ca17e1d.js";import{h as ne,a as le,b as ce,B as D,C as x,T as de,c as S}from"./ThePlayerActionsPanel-77e09012.js";import{c as ue,_ as ve}from"./cards.map-46f35cb5.js";function N(a){a.forEach(e=>{Object.values(e.actions).forEach(t=>{t.actions.forEach(s=>{s.reactivate()})})})}function _e(a){return a.reduce((e,t)=>{const s=t.actions;return Object.values(s).forEach(r=>{e+=r.actions.filter(o=>!o.isActivated).length}),e},0)}function fe(){const a=[...ue],e=[];for(let t=0;t<Y;t++){const s=Math.floor(Math.random()*a.length),r=a.splice(s,1);e.push(...r)}return e}function he(a){return a.reduce((e,t)=>e+=t.power,0)}function W(a){const e=a.length/3,t=he(a)/2;return e+t}function pe(a,e){const t=(e-a)*2,s=e/4;return t+s}function z(a,e){const{attackPower:t,leftHp:s,healPower:r}=e,o=s*pe(a.hp,a.maxHealPoints),i=t*W(a.actions.attack.actions),n=a instanceof ne?a.actions.heal.actions:[],_=r*W(n);return i+o+_}class me{constructor(e){y(this,"cardHealPowerPriority");y(this,"cardAttackPowerPriority");y(this,"cardLeftHpPriority");y(this,"botCards");y(this,"playersCards");this.cardHealPowerPriority=e.healPower,this.cardAttackPowerPriority=e.attackPower,this.cardLeftHpPriority=e.leftHp,this.botCards=e.botCards,this.playersCards=e.playerCards}async makeActions(){for(const e of this.botCards)if(e.isAlive){const t=Object.values(e.actions);for(const s of t)for(const r of s.actions)await new Promise(o=>{setTimeout(()=>{this.getTarget(r),o(!0)},J)})}}getTarget(e){let t;e instanceof le&&(t=this.getHealTarget()),e instanceof ce&&(t=this.getAttackTarget()),t&&e.activate(t)}getHealTarget(){const e=[];if(this.botCards.forEach(t=>{if(t.isAlive&&t.maxHealPoints!==t.hp){const s=z(t,{healPower:this.cardHealPowerPriority,attackPower:this.cardAttackPowerPriority,leftHp:this.cardLeftHpPriority});e.push({fighter:t,priority:s})}}),e.length!==0)return e.sort((t,s)=>s.priority-t.priority)[0].fighter}getAttackTarget(){return this.getAlive(this.playersCards).map(s=>{const r=z(s,{healPower:this.cardHealPowerPriority,attackPower:this.cardAttackPowerPriority,leftHp:this.cardLeftHpPriority});return{fighter:s,priority:r}}).sort((s,r)=>r.priority-s.priority)[0].fighter}getAlive(e){return e.filter(t=>t.isAlive)}}function O(a){const e=Math.trunc(a);return e<10?`0${e}`:e.toString()}const $=Q("fight",()=>{const a={number:0,timeLeft:0,minutes:"0",seconds:"0"},e=h({...a});let t;const s=g(()=>e.value.number%2!==0),r=()=>{e.value={...a}},o=()=>{++e.value.number,e.value.timeLeft=Z*60,t&&clearInterval(t),t=setInterval(()=>{e.value.timeLeft<=0?(i(),o()):(e.value.minutes=O(e.value.timeLeft/60),e.value.seconds=O(e.value.timeLeft%60),--e.value.timeLeft)},1e3)},i=()=>{clearInterval(t),e.value.timeLeft=0};return{tour:e,isPlayer:s,setInitialValue:r,startNewTour:o,endTour:i,startGame:()=>{r(),o()},endGame:()=>{clearInterval(t)}}}),ye={class:"graveyard__fighters"},ge=b({__name:"BaseGraveyard",props:{isPlayer:{type:Boolean},cardsFighters:{},cardSize:{}},setup(a){const e=a,t=h(!1),s=g(()=>e.isPlayer?"Player":"Enemy"),r=g(()=>e.cardsFighters.filter(o=>!o.isAlive));return(o,i)=>(d(),p("div",{class:"graveyard",style:ee(o.cardSize),onClick:i[2]||(i[2]=n=>t.value=!0)},[v(D,{"is-open":t.value,onClose:i[0]||(i[0]=n=>t.value=!1),onOpen:i[1]||(i[1]=n=>t.value=!0)},{header:m(()=>[F(P(s.value)+" graveyard ",1)]),body:m(()=>[u("div",ye,[(d(!0),p(T,null,I(r.value,n=>(d(),w(x,{key:n.name,class:"graveyard__card",fighter:n,"is-player":o.isPlayer},null,8,["fighter","is-player"]))),128))])]),_:1},8,["is-open"])],4))}});const R=E(ge,[["__scopeId","data-v-64d699e7"]]),Pe={class:"end-game__body"},Te={class:"end-game__stats"},we=b({__name:"EndGameScreen",props:{isWin:{type:Boolean},gameEnd:{type:Boolean}},setup(a){const e=$();return(t,s)=>(d(),w(D,{"is-open":t.gameEnd},{header:m(()=>[t.isWin?(d(),p(T,{key:0},[F(" Hey, you've won! ")],64)):(d(),p(T,{key:1},[F(" You've lost, but you can try again! ")],64))]),body:m(()=>[u("div",Pe,[u("div",Te," The game ended in "+P(C(e).tour.number)+" rounds. ",1),v(ve,{class:"end-game__link",to:{name:"choose-cards"}},{default:m(()=>[F(" Let's rock. ")]),_:1})])]),_:1},8,["is-open"]))}});const Ae=E(we,[["__scopeId","data-v-8ce6dc01"]]),ke={class:"tour-information"},Fe={class:"tour-information__number"},Ce={class:"tour-information__timer"},be=b({__name:"TheTourInformation",setup(a){const{tour:e}=te($());return(t,s)=>(d(),w(ae,{to:"body"},[u("div",ke,[u("div",Fe," Round: "+P(C(e).number),1),u("div",Ce," Time left: "+P(C(e).minutes)+":"+P(C(e).seconds),1)])]))}});const Ee=E(be,[["__scopeId","data-v-34014c18"]]),He={class:"fight-field"},Ie={class:"fight-field__graveyard"},xe={class:"fight-field__arena"},$e={class:"fight-field__player"},Be={class:"fight-field__enemy"},Me=b({__name:"TheFightField",setup(a){const e=se(),t=$(),s=h({width:"0px",height:"0px"}),r=h([]),o=h([]),i=h(),n=h(),_=g(()=>r.value.filter(l=>l.isAlive)),A=g(()=>o.value.filter(l=>l.isAlive)),B=g(()=>_.value.length===0||A.value.length===0),U=new me({healPower:3,leftHp:1.25,attackPower:1,playerCards:r.value,botCards:o.value}),V=()=>{e.cardsRaw.forEach(l=>{r.value.push(S(l))}),fe().forEach(l=>{o.value.push(S(l))}),ie(()=>{const l=document.querySelector(".card-fighter:first-child");if(l){const{clientHeight:f,clientWidth:c}=l;s.value.height=`${c}px`,s.value.width=`${f}px`}t.startGame()})},j=()=>{t.endGame()},M=(l,f)=>{var c;if(t.isPlayer){if(n.value){const k=n.value.actions.find(q=>!q.isActivated);k?k.activate(l):n.value=void 0,_e(_.value)<=0&&(n.value=void 0,i.value=void 0,t.endTour(),t.startNewTour()),(c=i.value)!=null&&c.isAlive||(i.value=void 0,n.value=void 0);return}if(i.value===l&&f){i.value=void 0,n.value=void 0;return}if(f){i.value=l,n.value=void 0;return}}},G=()=>{B.value&&t.endGame()};return re(V),oe(j),H(()=>t.isPlayer,async()=>{t.isPlayer?N(r.value):(N(o.value),await U.makeActions(),t.startNewTour())}),H(()=>_.value.length,G),H(()=>A.value.length,G),(l,f)=>(d(),p("div",He,[v(Ee),u("div",Ie,[v(R,{class:"fight-field__graveyard-player","is-player":!0,"cards-fighters":r.value,"card-size":s.value},null,8,["cards-fighters","card-size"]),v(R,{class:"fight-field__graveyard-enemy","is-player":!1,"cards-fighters":o.value,"card-size":s.value},null,8,["cards-fighters","card-size"])]),u("div",xe,[u("div",$e,[v(L,{name:"fight-field__list"},{default:m(()=>[(d(!0),p(T,null,I(_.value,c=>(d(),w(x,{key:c.name,fighter:c,"is-player":!0,"is-selected":c===i.value,onClick:k=>M(c,!0)},null,8,["fighter","is-selected","onClick"]))),128))]),_:1})]),u("div",Be,[v(L,{name:"fight-field__list"},{default:m(()=>[(d(!0),p(T,null,I(A.value,c=>(d(),w(x,{key:c.name,fighter:c,"is-player":!1,onClick:k=>M(c,!1)},null,8,["fighter","onClick"]))),128))]),_:1})]),v(de,{"selected-action":n.value,"onUpdate:selectedAction":f[0]||(f[0]=c=>n.value=c),"selected-card-fighter":i.value},null,8,["selected-action","selected-card-fighter"])]),v(Ae,{"game-end":B.value,"is-win":_.value>A.value},null,8,["game-end","is-win"])]))}});const We=E(Me,[["__scopeId","data-v-31891226"]]);export{We as default};
